# –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã Events –∏ Updates

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| **–í—Å–µ–≥–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π** | 11 |
| **–ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** | 11 (100%) |
| **–¢–∏–ø–æ–≤ Updates** | 4 |
| **–°–æ–±—ã—Ç–∏–π –Ω–∞ Update** | 1:1 (DialogUpdate), 1:N (MessageUpdate, DialogMemberUpdate) |

---

## üìã –¢–∞–±–ª–∏—Ü–∞ —Ç–∏–ø–æ–≤ Events

| –¢–∏–ø —Å–æ–±—ã—Ç–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ì–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è | –°–æ–∑–¥–∞–µ—Ç Update | –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ |
|------------|----------|--------------|----------------|------------|
| `dialog.create` | –°–æ–∑–¥–∞–Ω –¥–∏–∞–ª–æ–≥ | `dialogController.create` | `DialogUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `dialog.update` | –û–±–Ω–æ–≤–ª–µ–Ω –¥–∏–∞–ª–æ–≥ | `metaController.setMeta/deleteMeta` (–¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤) | `DialogUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `dialog.delete` | –£–¥–∞–ª–µ–Ω –¥–∏–∞–ª–æ–≥ | `dialogController.delete` | `DialogUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `message.create` | –°–æ–∑–¥–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ | `messageController.create` | `MessageUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `message.update` | –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ | `messageController.update`, `metaController.setMeta/deleteMeta` (–¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π) | `MessageUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `dialog.member.add` | –î–æ–±–∞–≤–ª–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫ | `dialogMemberController.addMember` | `DialogUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `dialog.member.remove` | –£–¥–∞–ª–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫ | `dialogMemberController.removeMember` | `DialogUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ + —É–¥–∞–ª—è–µ–º—ã–π |
| `dialog.member.update` | –û–±–Ω–æ–≤–ª–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫ | `userDialogController.updateMessageStatus`, `dialogMemberController.updateMember`, `metaController.setMeta/deleteMeta` (–¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) | `DialogMemberUpdate` | –¢–æ–ª—å–∫–æ —ç—Ç–æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ unreadCount, lastSeenAt –∏–ª–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ |
| `message.status.update` | –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å | `userDialogController.updateMessageStatus` | `MessageUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `message.reaction.update` | –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ä–µ–∞–∫—Ü–∏—è | `messageReactionController.setOrUnsetReaction` | `MessageUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| `dialog.typing` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç | `typingController.setTyping` | `TypingUpdate` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–∫—Ä–æ–º–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞) |

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ–∫—Ü–∏–π –≤ Events –∏ Updates

### –°–µ–∫—Ü–∏–∏ Events (–≤ –ø–æ–ª–µ `data`)

| –¢–∏–ø —Å–æ–±—ã—Ç–∏—è | –°–µ–∫—Ü–∏–∏ –≤ Event.data | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|---------------------|----------|
| `dialog.create` | `context`, `dialog` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ |
| `dialog.update` | `context`, `dialog` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ |
| `dialog.delete` | `context`, `dialog` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è–µ–º–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ |
| `message.create` | `context`, `dialog`, `message` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `message.update` | `context`, `dialog`, `message` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `dialog.member.add` | `context`, `dialog`, `member` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è–µ–º–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `dialog.member.remove` | `context`, `dialog`, `member` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è–µ–º–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `dialog.member.update` | `context`, `dialog`, `member` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `message.status.update` | `context`, `message` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º (statusUpdate, statusMessageMatrix) |
| `message.reaction.update` | `context`, `message` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∞–∫—Ü–∏–µ–π (reactionUpdate, reactionSet) |
| `dialog.typing` | `context`, `typing` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—á–∞—Ç–∞–Ω–∏–∏ |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `context` - –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (eventType, dialogId, entityId, includedSections, updatedFields)
- `dialog` - –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ (dialogId, tenantId, name, createdBy, createdAt, meta)
- `member` - –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞ (userId, meta, state: {unreadCount, lastSeenAt, lastMessageAt, isActive})
- `message` - –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (messageId, dialogId, senderId, type, content, meta, statusUpdate, reactionUpdate, statusMessageMatrix)
- `typing` - –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—á–∞—Ç–∞–Ω–∏–∏ (userId, expiresInMs, timestamp, userInfo)
- `actor` - **—É–±—Ä–∞–Ω–∞ –∏–∑ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π** (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –∫–æ—Ä–Ω–µ Event: `event.actorId`, `event.actorType`)

### –°–µ–∫—Ü–∏–∏ Updates (–≤ –ø–æ–ª–µ `data`)

| –¢–∏–ø Update | –°–µ–∫—Ü–∏–∏ –≤ Update.data | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------------------|----------|
| **DialogUpdate** | `context`, `dialog`, `member` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω update) |
| **DialogMemberUpdate** | `context`, `dialog`, `member` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| **MessageUpdate** | `context`, `dialog`, `message` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `member`) | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. `member` —Ç–æ–ª—å–∫–æ –¥–ª—è `message.create/update` |
| **TypingUpdate** | `context`, `dialog`, `member`, `typing` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è, –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞, –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—á–∞—Ç–∞–Ω–∏–∏ |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `context` - –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `dialog` - –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ (–±–µ—Ä–µ—Ç—Å—è –∏–∑ event.data –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
- `member` - –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω update (–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ). –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ MessageUpdate –¥–ª—è `message.status.update` –∏ `message.reaction.update`
- `message` - –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è: statusUpdate, reactionUpdate, statusMessageMatrix)
- `typing` - –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—á–∞—Ç–∞–Ω–∏–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π

#### –°–µ–∫—Ü–∏—è `context`
```javascript
{
  version: 2,
  eventType: 'message.create',
  dialogId: 'dlg_...',
  entityId: 'msg_...',
  messageId: 'msg_...', // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  includedSections: ['dialog', 'message'],
  updatedFields: ['message']
}
```

#### –°–µ–∫—Ü–∏—è `dialog`
```javascript
{
  dialogId: 'dlg_...',
  tenantId: 'tnt_...',
  name: 'Dialog Name', // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  createdBy: 'user_id',
  createdAt: 1234567890.123456,
  meta: { /* –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–∏–∞–ª–æ–≥–∞ */ }
}
```
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ–ª–µ `updatedAt` —É–¥–∞–ª–µ–Ω–æ –∏–∑ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π.

#### –°–µ–∫—Ü–∏—è `member`
```javascript
{
  userId: 'user_id',
  meta: { /* –º–µ—Ç–∞-—Ç–µ–≥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ */ },
  state: {
    unreadCount: 5,
    lastSeenAt: 1234567890.123456,
    lastMessageAt: 1234567890.123456,
    isActive: true
  }
}
```

#### –°–µ–∫—Ü–∏—è `message`
```javascript
{
  messageId: 'msg_...',
  dialogId: 'dlg_...',
  senderId: 'user_id',
  type: 'internal.text',
  content: 'Message text',
  meta: { /* –º–µ—Ç–∞-—Ç–µ–≥–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */ },
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è message.status.update:
  statusUpdate: { userId, status, oldStatus },
  statusMessageMatrix: [ /* –º–∞—Ç—Ä–∏—Ü–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */ ],
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è message.reaction.update:
  reactionUpdate: { userId, reaction, oldReaction, reactionSet }
}
```
**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `statusUpdate` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ `message.status.update` (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏ `null`)
- `reactionUpdate` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ `message.reaction.update` (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏ `null`)
- `statusMessageMatrix` - –º–∞—Ç—Ä–∏—Ü–∞ —Å—Ç–∞—Ç—É—Å–æ–≤, –∏—Å–∫–ª—é—á–∞—é—â–∞—è —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è

#### –°–µ–∫—Ü–∏—è `typing`
```javascript
{
  userId: 'user_id',
  expiresInMs: 5000,
  timestamp: 1234567890,
  userInfo: { /* –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ */ }
}
```

#### –°–µ–∫—Ü–∏—è `actor` (—É–¥–∞–ª–µ–Ω–∞)
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–µ–∫—Ü–∏—è `actor` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –∫–æ—Ä–Ω–µ Event:
- `event.actorId` - ID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞
- `event.actorType` - —Ç–∏–ø –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ ('user' | 'bot' | 'api' | 'system')

---

## üîÑ –¢–∏–ø—ã Updates –∏ –∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∏

| –¢–∏–ø Update | –°–æ–±—ã—Ç–∏—è-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ | –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-----------|-------------------|------------|-------------|
| **DialogUpdate** | `dialog.create`, `dialog.update`, `dialog.delete`, `dialog.member.add`, `dialog.member.remove` | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–∞ | –ü—Ä–∏ `dialog.member.remove` —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è —É–¥–∞–ª—è–µ–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **DialogMemberUpdate** | `dialog.member.update` | –¢–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ | –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π update –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **MessageUpdate** | `message.create`, `message.update`, `message.status.update`, `message.reaction.update` | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–∞ | –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è (status/reaction) |
| **TypingUpdate** | `dialog.typing` | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫—Ä–æ–º–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ | –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å expiresInMs |

---

## üîó –ú–∞–ø–ø–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –Ω–∞ Updates

### DialogUpdate Events
```javascript
DIALOG_UPDATE_EVENTS = [
  'dialog.create',
  'dialog.update',
  'dialog.delete',
  'dialog.member.add',
  'dialog.member.remove'
]
```

### DialogMemberUpdate Events
```javascript
DIALOG_MEMBER_UPDATE_EVENTS = [
  'dialog.member.update'
]
```

### MessageUpdate Events
```javascript
MESSAGE_UPDATE_EVENTS = [
  'message.create',
  'message.update',
  'message.reaction.update',
  'message.status.update'
]
```

### TypingUpdate Events
```javascript
TYPING_EVENTS = [
  'dialog.typing'
]
```

---

## ‚ö° –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
1. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç Event ‚Üí MongoDB
2. Event –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ RabbitMQ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
3. Update Worker –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
4. Update Worker –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é create*Update()
5. Update —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è ‚Üí MongoDB
6. Update –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ RabbitMQ —Å routing key: user.{type}.{userId}.{updateType}
```

---

## üéØ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤**
   - `message.update` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `dialog.member.update` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - `dialog.update` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤

2. **–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π**
   - `MessageStatus` —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
   - `message.status.update` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - `statusMessageMatrix` –∏—Å–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è

3. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–∫—Ü–∏–π**
   - `message.reaction.update` –∑–∞–º–µ–Ω—è–µ—Ç `add`/`remove`
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `reactionSet` –≤–º–µ—Å—Ç–æ `counts`

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–±—ã—Ç–∏–π**
   - –£–±—Ä–∞–Ω–∞ —Å–µ–∫—Ü–∏—è `actor` –∏–∑ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π (–¥–∞–Ω–Ω—ã–µ –≤ –∫–æ—Ä–Ω–µ Event)
   - –£–±—Ä–∞–Ω–∞ —Å–µ–∫—Ü–∏—è `member` –∏–∑ `message.status.update`, `message.reaction.update`, `dialog.typing`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `dialog` –≤ `dialog.member.add/remove/update` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `includedSections`: `['message.status']` ‚Üí `['message']`, `['message.reaction']` ‚Üí `['message']`
   - `reactionUpdate: null` –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `message.status.update`

### üí° –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–ë–∞—Ç—á–∏–Ω–≥ Updates**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Updates –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ RabbitMQ

2. **–£—Å–ª–æ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Updates**
   - –ü—Ä–æ–ø—É—Å–∫ Updates –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

3. **–î–µ–ª—å—Ç–∞-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   - –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ payload

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ |
|----------|----------|---------|
| **N+1 –∑–∞–ø—Ä–æ—Å—ã –º–µ—Ç–∞-—Ç–µ–≥–æ–≤** | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Update –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –º–µ—Ç–∞-—Ç–µ–≥–∏ –æ—Ç–¥–µ–ª—å–Ω–æ | –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** | –ö–∞–∂–¥—ã–π Update —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∫–æ–ø–∏—é dialog/message/member | –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ë–î –∏ RabbitMQ |
| **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** | –°–æ–∑–¥–∞–Ω–∏–µ Updates –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ | –ó–∞–¥–µ—Ä–∂–∫–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö API |

### 2. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–∏—Å–∫ |
|----------|----------|------|
| **Race conditions** | Event –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î | –ü–æ—Ç–µ—Ä—è Updates |
| **–ß–∞—Å—Ç–∏—á–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** | –ï—Å–ª–∏ RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, Updates —Å–æ–∑–¥–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è | –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö Updates |

### 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|----------|----------|---------|
| **–õ–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç Updates** | –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è N Updates (N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) | –ë–∞—Ç—á–∏–Ω–≥, —É—Å–ª–æ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è |
| **–ò–Ω–¥–µ–∫—Å—ã –ë–î** | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ Update –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª—è—Ç—å –∑–∞–ø–∏—Å—å | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Updates
2. ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è Updates** –≤ RabbitMQ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
3. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤** –Ω–∞ Update (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)
1. **–ë–∞—Ç—á–∏–Ω–≥ Updates**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ Updates –ø–æ userId –∏ dialogId
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –º–∞—Å—Å–∏–≤–æ–º Updates

2. **–£—Å–ª–æ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º Update
   - –£—á–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **–î–µ–ª—å—Ç–∞-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –≤ `updatedFields`
   - –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3+ –º–µ—Å—è—Ü–∞)
1. **Event Sourcing**
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π, Updates –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É
   - –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ë–î

2. **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Updates**
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ tenantId –∏–ª–∏ userId
   - –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö**
   - Gzip –¥–ª—è –±–æ–ª—å—à–∏—Ö Updates
   - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ç—å –∏ RabbitMQ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
|---------|------------------|-------------------|
| **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è Event** | < 50ms | ? |
| **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è Update** | < 100ms | ? |
| **–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ RabbitMQ** | < 200ms | ? |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö Updates** | < 1000 | ? |
| **–†–∞–∑–º–µ—Ä Update –≤ –ë–î** | < 10KB | ? |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Updates –Ω–∞ —Å–æ–±—ã—Ç–∏–µ** | = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚úÖ |

---

## üéì –í—ã–≤–æ–¥—ã

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–±—ã—Ç–∏—è–º–∏
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ Updates
- ‚úÖ –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
- ‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- ‚ö†Ô∏è –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ Updates
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
1. **–í—ã—Å–æ–∫–∏–π**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. **–°—Ä–µ–¥–Ω–∏–π**: –ë–∞—Ç—á–∏–Ω–≥ Updates
3. **–ù–∏–∑–∫–∏–π**: –î–µ–ª—å—Ç–∞-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## ü§î –ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ TypingUpdate

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**TypingUpdate** - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø Update –¥–ª—è —Å–æ–±—ã—Ç–∏—è `dialog.typing`:
- –ò–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å —Å–µ–∫—Ü–∏–µ–π `typing`
- –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ RabbitMQ —Å routing key `user.{type}.{userId}.typing`
- –ò—Å–∫–ª—é—á–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –∏–∑ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`expiresInMs`, `timestamp`)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ TypingUpdate

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | TypingUpdate | DialogUpdate |
|----------------|--------------|--------------|
| **–°–µ–º–∞–Ω—Ç–∏–∫–∞** | –í—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–π—Å—Ç–≤–∏–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ |
| **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –≠—Ñ–µ–º–µ—Ä–Ω–æ–µ (expiresInMs ~5 —Å–µ–∫) | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏) |
| **–ü–æ–ª—É—á–∞—Ç–µ–ª–∏** | –í—Å–µ –∫—Ä–æ–º–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ | –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** | `{dialog, member, typing}` | `{dialog, member}` |
| **Routing key** | `user.{type}.{userId}.typing` | `user.{type}.{userId}.dialogupdate` |

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º (—Ç–µ–∫—É—â–∏–π) ‚úÖ

**–ü–ª—é—Å—ã:**
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ (–¥–µ–π—Å—Ç–≤–∏–µ vs —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- ‚úÖ –†–∞–∑–Ω—ã–µ routing keys –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å typing updates, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã
- ‚úÖ –ü—Ä–æ—â–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –ù–µ –∑–∞—Å–æ—Ä—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é Updates –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (–ø–æ–ª—É—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –º–µ—Ç–∞-—Ç–µ–≥–æ–≤)
- ‚ùå –ë–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ Updates –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å DialogUpdate

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–µ–Ω—å—à–µ —Ç–∏–ø–æ–≤ Updates (—É–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞)
- ‚úÖ –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ (–¥–µ–π—Å—Ç–≤–∏–µ + —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- ‚ùå –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç typing updates –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚ùå Typing —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ Updates (–Ω–µ –Ω—É–∂–Ω–æ)
- ‚ùå –ù—É–∂–Ω–æ –º–µ–Ω—è—Ç—å routing key –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è –≤ DialogUpdate

**–ü–ª—é—Å—ã:**
- ‚úÖ –ï–¥–∏–Ω—ã–π —Ç–∏–ø Update
- ‚úÖ –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–∏—Å–∫–ª—é—á–∞—Ç—å typing —Å–µ–∫—Ü–∏—é
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã DialogUpdate
- ‚ùå –ù—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏
- ‚ùå –í—Å–µ —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–û—Å—Ç–∞–≤–∏—Ç—å TypingUpdate –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ç–∏–ø–æ–º** –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:

1. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞**
   - Typing - —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–π—Å—Ç–≤–∏–∏, –∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - DialogUpdate - —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ —Ç–∏–ø—ã updates
   - –ù–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å typing, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
   - –†–∞–∑–Ω—ã–µ routing keys –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏

3. **–ò—Å—Ç–æ—Ä–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**
   - Typing updates –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ (—ç—Ñ–µ–º–µ—Ä–Ω—ã–µ)
   - DialogUpdate —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**
   - –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å typing –æ—Ç–¥–µ–ª—å–Ω–æ (–ø–æ–∫–∞–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞)
   - –ù–µ –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å DialogUpdate –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è typing
   - –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ expiresInMs

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

–ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ Updates –∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ:
1. **–°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π —Ç–∏–ø `NotificationUpdate`** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   - `dialog.typing` ‚Üí `NotificationUpdate` (—Ç–∏–ø: 'typing')
   - –í –±—É–¥—É—â–µ–º: `user.online`, `user.away` –∏ —Ç.–¥.
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ `ephemeral: true`** –≤ Update –º–æ–¥–µ–ª–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å ephemeral updates** –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è

–≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –Ω–æ —É–º–µ–Ω—å—à–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤.

---

## üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ DialogUpdate –∏ DialogMemberUpdate

### –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | DialogUpdate | DialogMemberUpdate |
|----------------|-------------|-------------------|
| **–ü–æ–ª—É—á–∞—Ç–µ–ª–∏** | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–∞ | –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ |
| **–°–æ–±—ã—Ç–∏—è-–∏—Å—Ç–æ—á–Ω–∏–∫–∏** | `dialog.create`, `dialog.update`, `dialog.delete`, `dialog.member.add`, `dialog.member.remove` | `dialog.member.update` |
| **–°–µ–º–∞–Ω—Ç–∏–∫–∞** | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| **entityId** | `dialogId` (–¥–∏–∞–ª–æ–≥) | `dialogId` (–¥–∏–∞–ª–æ–≥) |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Updates** | N (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) | 1 (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞) |
| **–°–µ–∫—Ü–∏–∏ –≤ data** | `{dialog, member}` | `{dialog, member}` |
| **Routing key** | `user.{type}.{userId}.dialogupdate` | `user.{type}.{userId}.dialogmemberupdate` |

### –ü–æ—á–µ–º—É `dialog.member.add` —Å–æ–∑–¥–∞–µ—Ç DialogUpdate?

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:

**DialogUpdate** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ **–∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞**:
- ‚úÖ `dialog.create` - –≤—Å–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –æ –Ω–æ–≤–æ–º –¥–∏–∞–ª–æ–≥–µ
- ‚úÖ `dialog.update` - –≤—Å–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∏–∞–ª–æ–≥–µ
- ‚úÖ `dialog.delete` - –≤—Å–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ `dialog.member.add` - **–≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**
- ‚úÖ `dialog.member.remove` - **–≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**

**DialogMemberUpdate** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ **–∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞**:
- ‚úÖ `dialog.member.update` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ `unreadCount`, `lastSeenAt`, **–º–µ—Ç–∞-—Ç–µ–≥–æ–≤** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

#### –ü—Ä–∏–º–µ—Ä: `dialog.member.add`

–ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ (`dialog.member.add`):

1. **–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å:**
   - –ö—Ç–æ –¥–æ–±–∞–≤–∏–ª—Å—è –≤ –¥–∏–∞–ª–æ–≥
   - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - –ù–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤ –¥–∏–∞–ª–æ–≥–∞

2. **–°–æ–∑–¥–∞–µ—Ç—Å—è DialogUpdate –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:**
   ```javascript
   // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–≤–∫–ª—é—á–∞—è –Ω–æ–≤–æ–≥–æ)
   {
     dialog: { dialogId, ... },
     member: { userId: 'current_user', ... }, // –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
     context: {
       eventType: 'dialog.member.add',
       // ...
     }
   }
   ```

3. **–ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç:**
   - –ê–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∏–∞–ª–æ–≥–µ
   - –°–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è (—á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ)

#### –ü—Ä–∏–º–µ—Ä: `dialog.member.update`

–ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (`dialog.member.update`):

1. **–¢–æ–ª—å–∫–æ —ç—Ç–æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å:**
   - –°–≤–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `unreadCount`
   - –°–≤–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `lastSeenAt`
   - –°–≤–æ–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–∞-—Ç–µ–≥–∏

2. **–°–æ–∑–¥–∞–µ—Ç—Å—è DialogMemberUpdate —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:**
   ```javascript
   {
     dialog: { dialogId, ... },
     member: { 
       userId: 'updated_user',
       state: { unreadCount: 5, lastSeenAt: ... }
     },
     context: {
       eventType: 'dialog.member.update',
       updatedFields: ['member.state.unreadCount']
     }
   }
   ```

3. **–î—Ä—É–≥–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç update:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ `unreadCount` –¥—Ä—É–≥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
   - –≠—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–æ–∑–¥–∞—Ç—å DialogMemberUpdate –¥–ª—è `dialog.member.add`:
- ‚ùå –ù–æ —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å Update –¥–ª—è **–≤—Å–µ—Ö** —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚ùå –≠—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É DialogUpdate
- ‚ùå –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `dialog.member.add` - —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞, –∞ –Ω–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞

### –í—ã–≤–æ–¥

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏—á–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

1. **DialogUpdate** = –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ **–≤—Å–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å**
   - –°–æ—Å—Ç–∞–≤ –¥–∏–∞–ª–æ–≥–∞ (add/remove)
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ (create/update/delete)

2. **DialogMemberUpdate** = –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ **–∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ**
   - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (unreadCount, lastSeenAt)
   - **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞-—Ç–µ–≥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞** (—á–µ—Ä–µ–∑ `metaController.setMeta/deleteMeta` —Å `entityType='dialogMember'`)

### –ö–æ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `dialog.member.update`?

–°–æ–±—ã—Ç–∏–µ `dialog.member.update` —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ç—Ä–µ—Ö —Å–ª—É—á–∞—è—Ö:

1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ unreadCount/lastSeenAt** (`userDialogController.updateMessageStatus`)
   - –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞** (`dialogMemberController.updateMember`)
   - –ü—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏, —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥.

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞** (`metaController.setMeta/deleteMeta` —Å `entityType='dialogMember'`)
   - –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ/—É–¥–∞–ª–µ–Ω–∏–∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ –¥–ª—è DialogMember
   - `entityId` –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç: `dialogId:userId`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ —Å `updatedFields: ['member.meta']`

3. **`dialog.member.add` –≤ DialogUpdate** –ø–æ—Ç–æ–º—É —á—Ç–æ:
   - –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ **—Å–æ—Å—Ç–∞–≤–∞ –¥–∏–∞–ª–æ–≥–∞**
   - –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - –≠—Ç–æ –Ω–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

---

## üéØ –ê–Ω–∞–ª–∏–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ–∫—Ü–∏–π

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ–∫—Ü–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:**
- ‚úÖ `actor` - —É–±—Ä–∞–Ω–∞ –∏–∑ –≤—Å–µ—Ö Events (–¥–∞–Ω–Ω—ã–µ –≤ –∫–æ—Ä–Ω–µ Event)
- ‚úÖ `member` - —É–±—Ä–∞–Ω–∞ –∏–∑ `message.status.update`, `message.reaction.update`, `dialog.typing`
- ‚úÖ `dialog` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `dialog.member.*` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker
- ‚úÖ `message` - –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ–π –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ–π (statusUpdate, reactionUpdate, statusMessageMatrix)
- ‚úÖ `reactionUpdate: null` - –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `message.status.update`

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. –°–µ–∫—Ü–∏—è `dialog` –≤ Updates

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç: `dialogId`, `tenantId`, `name`, `createdBy`, `createdAt`, `meta`
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `updatedAt` —É–¥–∞–ª–µ–Ω–æ –∏–∑ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

**–ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:**
| –¢–∏–ø Update | –ù—É–∂–µ–Ω dialog? | –ß—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ |
|-----------|---------------|------------------------|
| **DialogUpdate** | ‚úÖ –î–∞ | –ü–æ–ª–Ω–∞—è —Å–µ–∫—Ü–∏—è (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞) |
| **DialogMemberUpdate** | ‚úÖ –î–∞ | –ü–æ–ª–Ω–∞—è —Å–µ–∫—Ü–∏—è (–±–µ—Ä–µ—Ç—Å—è –∏–∑ event.data –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏) |
| **MessageUpdate** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ `dialogId` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–µ—Å—Ç—å –≤ context) |
| **TypingUpdate** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ `dialogId` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–µ—Å—Ç—å –≤ context) |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–ª—è `DialogUpdate` –∏ `DialogMemberUpdate` - –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–µ–∫—Ü–∏—é (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –±–µ—Ä–µ—Ç—Å—è –∏–∑ event.data)
- –î–ª—è `MessageUpdate` –∏ `TypingUpdate` - –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ `{dialogId}` –∏–ª–∏ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ `dialogId` –µ—Å—Ç—å –≤ `context`

**–≠–∫–æ–Ω–æ–º–∏—è:** ~200-500 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥—ã–π Update (MessageUpdate, TypingUpdate)

#### 2. –°–µ–∫—Ü–∏—è `member` –≤ MessageUpdate ‚úÖ **–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û**

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –£–±—Ä–∞–Ω–∞ –∏–∑ `message.status.update` –∏ `message.reaction.update`
- –û—Å—Ç–∞–µ—Ç—Å—è –≤ `message.create` –∏ `message.update` (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º)

**–ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:**
| –°—Ü–µ–Ω–∞—Ä–∏–π | –ù—É–∂–µ–Ω member? | –°—Ç–∞—Ç—É—Å |
|----------|---------------|--------|
| `message.create` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –û—Å—Ç–∞–µ—Ç—Å—è (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å) |
| `message.update` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –û—Å—Ç–∞–µ—Ç—Å—è (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å) |
| `message.status.update` | ‚ùå –ù–µ—Ç | ‚úÖ **–£–±—Ä–∞–Ω–∞** |
| `message.reaction.update` | ‚ùå –ù–µ—Ç | ‚úÖ **–£–±—Ä–∞–Ω–∞** |

**–≠–∫–æ–Ω–æ–º–∏—è:** ~150-300 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥—ã–π MessageUpdate (status/reaction)

#### 3. –°–µ–∫—Ü–∏—è `actor` –≤ Events ‚úÖ **–£–î–ê–õ–ï–ù–ê**

**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π.

**–ü—Ä–∏—á–∏–Ω–∞:**
- `actorId` –∏ `actorType` —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∫–æ—Ä–Ω–µ Event –º–æ–¥–µ–ª–∏
- `data.actor.info` –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
- –î–ª—è `dialog.typing` –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `typing.userInfo`

**–≠–∫–æ–Ω–æ–º–∏—è:** ~100-300 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ

#### 4. –°–µ–∫—Ü–∏—è `dialog` –≤ Events ‚úÖ **–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û**

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å–µ–∫—Ü–∏—é —Å meta (–±–µ–∑ `updatedAt`)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `dialog.member.add/remove/update` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker

**–ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:**
| –¢–∏–ø —Å–æ–±—ã—Ç–∏—è | –ù—É–∂–µ–Ω dialog? | –°—Ç–∞—Ç—É—Å |
|------------|---------------|--------|
| `dialog.create/update/delete` | ‚úÖ –î–∞ | –ü–æ–ª–Ω–∞—è —Å–µ–∫—Ü–∏—è |
| `dialog.member.add/remove/update` | ‚úÖ –î–∞ | ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞** (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker) |
| `message.*` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ `dialogId` (–µ—Å—Ç—å –≤ context) - –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å |
| `dialog.typing` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ `dialogId` (–µ—Å—Ç—å –≤ context) - –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–ª—è —Å–æ–±—ã—Ç–∏–π –¥–∏–∞–ª–æ–≥–∞ –∏ `dialog.member.*` - –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–µ–∫—Ü–∏—é
- –î–ª—è `message.*` –∏ `dialog.typing` - –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å (–µ—Å—Ç—å `dialogId` –≤ context)

**–≠–∫–æ–Ω–æ–º–∏—è:** ~200-500 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ (message.*, dialog.typing)

#### 5. –ú–µ—Ç–∞-—Ç–µ–≥–∏ –≤ —Å–µ–∫—Ü–∏—è—Ö

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤—Å–µ –º–µ—Ç–∞-—Ç–µ–≥–∏

**–ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:**
| –°–µ–∫—Ü–∏—è | –í—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã meta? | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|--------|-------------------|-------------|
| `dialog.meta` | ‚ùå –ù–µ—Ç | –í–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å |
| `member.meta` | ‚ùå –ù–µ—Ç | –í–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å |
| `message.meta` | ‚ùå –ù–µ—Ç | –í–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í–∫–ª—é—á–∞—Ç—å `meta` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å (—Å–æ–±—ã—Ç–∏—è update)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ `includeMeta: false` –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –≥–¥–µ meta –Ω–µ –Ω—É–∂–Ω—ã

**–≠–∫–æ–Ω–æ–º–∏—è:** ~100-1000+ –±–∞–π—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ meta

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | –≠–∫–æ–Ω–æ–º–∏—è | –°—Ç–∞—Ç—É—Å |
|-------------|----------------|------------------|----------|--------|
| `member` –≤ MessageUpdate (status/reaction) | ~200 –±–∞–π—Ç | 0 –±–∞–π—Ç | ~200 –±–∞–π—Ç | ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** |
| `actor` –≤ Events | ~150 –±–∞–π—Ç | 0 –±–∞–π—Ç | ~150 –±–∞–π—Ç | ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** |
| `dialog` –≤ dialog.member.* Events | 0 –±–∞–π—Ç (–±—ã–ª–æ) | ~300 –±–∞–π—Ç | -300 –±–∞–π—Ç | ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ** (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker) |
| `includedSections` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã | - | - | - | ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** |
| `reactionUpdate: null` —É–±—Ä–∞–Ω | ~20 –±–∞–π—Ç | 0 –±–∞–π—Ç | ~20 –±–∞–π—Ç | ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** |
| `dialog` –≤ MessageUpdate | ~300 –±–∞–π—Ç | ~20 –±–∞–π—Ç (—Ç–æ–ª—å–∫–æ dialogId) | ~280 –±–∞–π—Ç | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| `dialog` –≤ Events (message.*, typing) | ~300 –±–∞–π—Ç | ~20 –±–∞–π—Ç | ~280 –±–∞–π—Ç | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| `meta` –≤ —Å–µ–∫—Ü–∏—è—Ö | 100-1000+ –±–∞–π—Ç | 0 –±–∞–π—Ç (–µ—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å) | 100-1000+ –±–∞–π—Ç | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

#### –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**
1. ‚úÖ –£–±—Ä–∞—Ç—å `member` —Å–µ–∫—Ü–∏—é –∏–∑ MessageUpdate –¥–ª—è `message.status.update` –∏ `message.reaction.update`
2. ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å `actor` —Å–µ–∫—Ü–∏—é –∏–∑ Events** (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –∫–æ—Ä–Ω–µ Event, `info` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `dialog` —Å–µ–∫—Ü–∏—é –≤ `dialog.member.*` —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `includedSections` –¥–ª—è —Å–æ–±—ã—Ç–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π
5. ‚úÖ –£–±—Ä–∞—Ç—å `reactionUpdate: null` –∏–∑ `message.status.update`

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~600-900 –±–∞–π—Ç –Ω–∞ Update/Event

#### –§–∞–∑–∞ 2: –°—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ‚è≥ **–ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø**
1. ‚è≥ –£—Å–ª–æ–≤–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ `meta` (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å)
2. ‚è≥ –°–æ–∫—Ä–∞—Ç–∏—Ç—å `dialog` —Å–µ–∫—Ü–∏—é –≤ Events (–∫—Ä–æ–º–µ dialog.*)
3. ‚è≥ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `member` —Å–µ–∫—Ü–∏—é –≤ MessageUpdate (create/update)

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~300-500 –±–∞–π—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

#### –§–∞–∑–∞ 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ‚è≥ **–ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø**
1. ‚è≥ –î–µ–ª—å—Ç–∞-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è)
2. ‚è≥ –°–∂–∞—Ç–∏–µ –±–æ–ª—å—à–∏—Ö payload (gzip)
3. ‚è≥ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ–∫—Ü–∏–π

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~50-70% —Ä–∞–∑–º–µ—Ä–∞ payload

### –†–∏—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –ö–ª–∏–µ–Ω—Ç—ã –æ–∂–∏–¥–∞—é—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API, —Ñ–ª–∞–≥ `fullPayload: true` |
| –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, batch-–∑–∞–ø—Ä–æ—Å—ã |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏ | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–ª–∞–≥–∏ |

### –í—ã–≤–æ–¥

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:**
- ‚úÖ –£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (`member` –≤ status/reaction updates, `actor` –∏–∑ –≤—Å–µ—Ö Events)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `dialog` –≤ `dialog.member.*` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ updateWorker
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `includedSections` –¥–ª—è —Å–æ–±—ã—Ç–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –£–±—Ä–∞–Ω `reactionUpdate: null` –∏–∑ `message.status.update`

**–î–∞–ª—å–Ω–µ–π—à–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):**
- ‚è≥ –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Å–µ–∫—Ü–∏–∏ –¥–æ –º–∏–Ω–∏–º—É–º–∞ (`dialog` —Ç–æ–ª—å–∫–æ `dialogId` –¥–ª—è message.*, typing)
- ‚è≥ –£—Å–ª–æ–≤–Ω–æ –≤–∫–ª—é—á–∞—Ç—å `meta` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- ‚è≥ –î–µ–ª—å—Ç–∞-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö payload

**–≠–∫–æ–Ω–æ–º–∏—è:** ~350-450 –±–∞–π—Ç –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ/update (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: 2025-01-27*
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-27*
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: 0.0.13*

