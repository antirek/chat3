# План улучшений Chat3

Общий список планируемых улучшений по направлениям. Детали и приоритеты уточняются по мере реализации.

---

## Фильтры

### 1. Опция ИЛИ между условиями

**Текущее состояние:** В строковом формате фильтра условия объединяются только через `&` (логическое И). Разделителя для ИЛИ между разными условиями нет.

**Цель:** Добавить поддержку ИЛИ между условиями, например через разделитель `|` в строке:
- `(type,eq,internal.text)|(type,eq,system)` — тип равен internal.text **или** system
- Комбинация с И: `(senderId,eq,carl)&((type,eq,a)|(type,eq,b))`

**Задачи:**
- [ ] Определить синтаксис (разделитель `|`, приоритет скобок, вложенность)
- [ ] Обновить `parseFilters` в `packages/tenant-api/src/utils/queryParser.ts`: разбор `|`, формирование `$or` в MongoDB-запросе
- [ ] Убедиться, что все контроллеры, использующие фильтры (userDialogController, messageController, dialogController, userController и др.), корректно обрабатывают `$or`
- [ ] Обновить документацию (API.md, INTEGRATION.md, TOPICS_FILTERS.md) и примеры в UI

---

### 2. Убрать поддержку сырого JSON в параметре filter

**Текущее состояние:** Если строка `filter` начинается с `{`, она парсится как JSON и передаётся в запрос как есть. Это не документировано и создаёт риски (инъекция запросов, непредсказуемое поведение).

**Цель:** Удалить парсинг JSON из параметра `filter`; единственным форматом считать строковый `(field,operator,value)&...` (и в перспективе — с поддержкой `|` для ИЛИ).

**Задачи:**
- [ ] В `parseFilters` убрать ветку `if (trimmed.startsWith('{')) { return JSON.parse(trimmed); }`
- [ ] При необходимости добавить явную ошибку 400 с сообщением о неверном формате, если передан объект/JSON
- [ ] Проверить тесты и использование filter в коде; при необходимости обновить или удалить тесты, завязанные на JSON
- [ ] Упомянуть в документации, что JSON не поддерживается

---

*Другие разделы плана добавляются по мере появления задач.*
