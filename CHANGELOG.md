# Changelog

## [Latest] - 2025-10-23

### üÜï –î–æ–±–∞–≤–ª–µ–Ω–æ

#### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ üî• **–ù–û–í–û–ï!**
- **QueryParser** - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞: `(field,operator,value)` 
- **10 –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**: `eq`, `ne`, `in`, `nin`, `gt`, `gte`, `lt`, `lte`, `regex`, `exists`
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `&`: `(meta.type,eq,internal)&(meta.channelType,ne,telegram)`
- **–û–ø–µ—Ä–∞—Ç–æ—Ä `ne` (–ù–ï —Ä–∞–≤–Ω–æ)** - –∫–ª—é—á–µ–≤–∞—è —Ñ–∏—á–∞! –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å "–≤—Å–µ –∫—Ä–æ–º–µ..."
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (`ne`, `nin`) –¥–ª—è Meta –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤ –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö: `(meta.type,in,[internal,external])`

#### Meta —Ç–µ–≥ `channelType` –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π meta —Ç–µ–≥ `channelType` —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `whatsapp` –∏–ª–∏ `telegram`
- –ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞–Ω–∞–ª—É —á–µ—Ä–µ–∑ API

#### –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- **100 –¥–∏–∞–ª–æ–≥–æ–≤** –≤–º–µ—Å—Ç–æ –ø—Ä–µ–∂–Ω–∏—Ö 10
- 70 internal + 30 external
- 50 WhatsApp + 50 Telegram
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã: private, group, channel

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- **–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç** (–≤—Å–µ –µ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è): `{"meta":{"channelType":"whatsapp"}}`
- **–ù–æ–≤—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**: `(meta.channelType,ne,telegram)`
- **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**: `(meta.type,eq,internal)&(meta.channelType,ne,telegram)` ‚Üí 35 –¥–∏–∞–ª–æ–≥–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `$and` –≤ extractMetaFilters –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ seed

```
Tenants:            2 (1 system + 1 demo)
Users:              4 (1 system bot + 3 demo users)
Dialogs:            100 (70 internal + 30 external)
DialogParticipants: 199
Messages:           3
Meta:               605 (5 system/user/tenant + 600 dialog)
```

### üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### –§–æ—Ä–º–∞—Ç 1: JSON (—Å—Ç–∞—Ä—ã–π, –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```bash
# –í—Å–µ WhatsApp –¥–∏–∞–ª–æ–≥–∏ (50)
GET /api/dialogs?filter={"meta":{"channelType":"whatsapp"}}

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ WhatsApp (35)
GET /api/dialogs?filter={"meta":{"type":"internal","channelType":"whatsapp"}}
```

#### –§–æ—Ä–º–∞—Ç 2: –û–ø–µ—Ä–∞—Ç–æ—Ä—ã (–Ω–æ–≤—ã–π, –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π) üÜï

```bash
# –ù–ï telegram = —Ç–æ–ª—å–∫–æ WhatsApp (50)
GET /api/dialogs?filter=(meta.channelType,ne,telegram)

# Internal + –ù–ï telegram = internal WhatsApp (35) ‚≠ê
GET /api/dialogs?filter=(meta.type,eq,internal)&(meta.channelType,ne,telegram)

# External + –ù–ï whatsapp = external Telegram (15)
GET /api/dialogs?filter=(meta.type,eq,external)&(meta.channelType,ne,whatsapp)

# –í –º–∞—Å—Å–∏–≤–µ: type –≤ [internal, external] (100)
GET /api/dialogs?filter=(meta.type,in,[internal,external])

# –ù–ï –≤ –º–∞—Å—Å–∏–≤–µ: channelType –ù–ï –≤ [telegram] (50)
GET /api/dialogs?filter=(meta.channelType,nin,[telegram])
```

#### –í—Å–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------|
| `eq` | –†–∞–≤–Ω–æ | `(meta.type,eq,internal)` |
| `ne` | **–ù–ï —Ä–∞–≤–Ω–æ** üÜï | `(meta.channelType,ne,telegram)` |
| `in` | –í –º–∞—Å—Å–∏–≤–µ | `(meta.type,in,[internal,external])` |
| `nin` | –ù–ï –≤ –º–∞—Å—Å–∏–≤–µ | `(meta.channelType,nin,[telegram,whatsapp])` |
| `gt` | –ë–æ–ª—å—à–µ | `(meta.maxParticipants,gt,50)` |
| `gte` | –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `(meta.maxParticipants,gte,50)` |
| `lt` | –ú–µ–Ω—å—à–µ | `(meta.maxParticipants,lt,10)` |
| `lte` | –ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `(meta.maxParticipants,lte,10)` |
| `regex` | –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ | `(meta.type,regex,^int)` |
| `exists` | –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è | `(meta.channelType,exists,true)` |

### üéØ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

- **–ü–æ —Ç–∏–ø—É:** 70% internal, 30% external
- **–ü–æ –∫–∞–Ω–∞–ª—É:** 50% WhatsApp, 50% Telegram
- **–ü–æ —Ç–∏–ø—É –¥–∏–∞–ª–æ–≥–∞:** ~34% private, ~34% group, ~33% channel

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:**
- Internal + WhatsApp: 70 √ó 0.5 = 35 –¥–∏–∞–ª–æ–≥–æ–≤ ‚úÖ
- Internal + Telegram: 70 √ó 0.5 = 35 –¥–∏–∞–ª–æ–≥–æ–≤ ‚úÖ
- External + WhatsApp: 30 √ó 0.5 = 15 –¥–∏–∞–ª–æ–≥–æ–≤ ‚úÖ
- External + Telegram: 30 √ó 0.5 = 15 –¥–∏–∞–ª–æ–≥–æ–≤ ‚úÖ

### üìù –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- `src/scripts/seed.js` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è 100 –¥–∏–∞–ª–æ–≥–æ–≤ —Å channelType

### üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### Seed —Å–∫—Ä–∏–ø—Ç
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 100 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω –¥–∏–∞–ª–æ–≥–æ–≤
- –ß–µ—Ä–µ–¥—É–µ—Ç channelType (—á–µ—Ç–Ω—ã–µ - whatsapp, –Ω–µ—á–µ—Ç–Ω—ã–µ - telegram)
- –ß–µ—Ä–µ–¥—É–µ—Ç —Ç–∏–ø—ã –¥–∏–∞–ª–æ–≥–æ–≤ (private, group, channel)
- –°–æ–∑–¥–∞–µ—Ç 6 meta –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥

#### API —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MongoDB aggregation –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ Meta –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- AND –ª–æ–≥–∏–∫–∞ –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ meta —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –æ–±—ã—á–Ω—ã–º–∏ query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (type, isActive, etc.)

### üîë –ù–æ–≤—ã–µ API –∫–ª—é—á–∏

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å API –∫–ª—é—á–∏:

```bash
# –î–ª—è Demo Company (–≥–¥–µ 100 –¥–∏–∞–ª–æ–≥–æ–≤)
npm run generate-api-key <tenant_id> "Demo Company API Key"

# –î–ª—è System
npm run generate-api-key <system_tenant_id> "System API Key"
```

### ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `channelType=whatsapp` ‚Üí 50 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `channelType=telegram` ‚Üí 50 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä `type=internal&channelType=whatsapp` ‚Üí 35 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä `type=external&channelType=telegram` ‚Üí 15 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –í—Å–µ meta —Ç–µ–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ AdminJS
- ‚úÖ Swagger UI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É —Å 100 –¥–∏–∞–ª–æ–≥–∞–º–∏
npm run seed

# 2. –ü–æ–ª—É—á–∏—Ç—å tenant ID Demo Company
node -e "import('./src/config/database.js').then(db => db.default()).then(() => import('./src/models/index.js').then(m => m.Tenant.findOne({domain: 'demo.chat3.com'}).then(t => console.log(t._id))))"

# 3. –°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á
npm run generate-api-key <tenant_id> "My API Key"

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Swagger UI
# http://localhost:3000/api-docs
```

---

## –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏

### [Initial] - 2025-10-23

- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Chat3
- MongoDB –º–æ–¥–µ–ª–∏: Tenant, User, Dialog, DialogParticipant, Message, Meta, ApiKey
- REST API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ API –∫–ª—é—á—É
- AdminJS –ø–∞–Ω–µ–ª—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–∏—Å—Ç–µ–º–Ω—ã–π –±–æ—Ç
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ meta —Ç–µ–≥–∞–º
- 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

