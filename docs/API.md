# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Chat3

## –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:3000/api
```

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`:

```http
X-API-Key: your-api-key-here
X-Tenant-ID: tnt_default
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è API –∫–ª—é—á–∞

```bash
npm run generate-key
```

## –û–±—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

- `X-API-Key` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `X-Tenant-ID` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID —Ç–µ–Ω–∞–Ω—Ç–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `tnt_default`
- `X-Idempotency-Key` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ö–ª—é—á –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "data": { ... },
  "message": "–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
}
```

### –û—à–∏–±–∫–∞

```json
{
  "error": "Error Type",
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

## –ü–∞–≥–∏–Ω–∞—Ü–∏—è

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ endpoints –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é:

- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10-50)

–û—Ç–≤–µ—Ç —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

```json
{
  "data": [ ... ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "pages": 10
  }
}
```

## –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤:

### 1. JSON —Ñ–æ—Ä–º–∞—Ç

```json
{
  "meta": {
    "type": "internal"
  }
}
```

### 2. –û–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
(field,operator,value)
```

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:**
- `eq` - —Ä–∞–≤–Ω–æ
- `ne` - –Ω–µ —Ä–∞–≤–Ω–æ
- `in` - –≤ –º–∞—Å—Å–∏–≤–µ: `(type,in,[user,bot])`
- `nin` - –Ω–µ –≤ –º–∞—Å—Å–∏–≤–µ
- `gt` - –±–æ–ª—å—à–µ
- `gte` - –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `lt` - –º–µ–Ω—å—à–µ
- `lte` - –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `regex` - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
- `exists` - —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (AND):**
```
(meta.type,eq,internal)&(meta.channelType,ne,telegram)
```

**–ò–õ–ò (OR) –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–±–∫–∞–º–∏:**
- –£—Å–ª–æ–≤–∏—è –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —á–µ—Ä–µ–∑ `&` (–ò) –∏ `|` (–ò–õ–ò).
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—ë—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Å–∫–æ–±–∫–∞–º–∏**; –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ç–∏–ø –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (`&` –∏–ª–∏ `|`).
- –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `&` –∏ `|` —Å–∫–æ–±–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. –ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ: `a&b|c` –±–µ–∑ —Å–∫–æ–±–æ–∫.
- –õ–∏–º–∏—Ç **5**: –Ω–µ –±–æ–ª–µ–µ 5 –≤–µ—Ç–æ–∫ –≤ `$or` –∏ –Ω–µ –±–æ–ª–µ–µ 5 –æ–ø–µ—Ä–∞–Ω–¥–æ–≤ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Ñ–æ—Ä–º—ã (—Å–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ –±–µ–∑ —Å–∫–æ–±–æ–∫, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É 400 (Filter validation failed).
- JSON –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `filter` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç).

**–ü—Ä–∏–º–µ—Ä—ã —Å –ò–õ–ò:**
- `(meta.name,eq,a)|(meta.name,eq,b)` ‚Äî meta.name —Ä–∞–≤–µ–Ω a –∏–ª–∏ b
- `((meta.type,eq,internal)&(meta.channelType,eq,whatsapp))|(meta.name,eq,personal)` ‚Äî (type=internal –∏ channel=whatsapp) –∏–ª–∏ name=personal

**–ü—Ä–∏–º–µ—Ä—ã:**
- `(userId,eq,cnt_72a454kho)` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- `(name,regex,^John)` - –∏–º—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å John
- `(type,in,[user,bot])` - —Ç–∏–ø –≤ —Å–ø–∏—Å–∫–µ
- `(meta.role,eq,manager)` - —Ñ–∏–ª—å—Ç—Ä –ø–æ meta —Ç–µ–≥—É

**–ê–ª—Ñ–∞–≤–∏—Ç meta-–∫–ª—é—á–∞:**  
–ö–ª—é—á meta –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã (a‚Äìz, A‚ÄìZ), —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ. –¢–æ—á–∫–∞ –∏ –¥–µ—Ñ–∏—Å –∑–∞–ø—Ä–µ—â–µ–Ω—ã; –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `contact_phone`). –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤–æ –≤—Å–µ—Ö endpoint'–∞—Ö: PUT/DELETE meta, body —Å –ø–æ–ª–µ–º `meta` (–¥–∏–∞–ª–æ–≥, —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç–æ–ø–∏–∫, tenant –∏ —Ç.–¥.), –∞ —Ç–∞–∫–∂–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `filter`. –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–ª—é—á–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ 400 (Bad Request –∏–ª–∏ Filter validation failed).

**–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∏–ª—å—Ç—Ä–∞ (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, AND/OR, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–±–∫–∞–º–∏, –ª–∏–º–∏—Ç—ã) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö endpoint'–∞—Ö, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏—Ö query-–ø–∞—Ä–∞–º–µ—Ç—Ä `filter`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –¥–∏–∞–ª–æ–≥–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, —Ç–æ–ø–∏–∫–∏, —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤, –¥–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## Endpoints

### Tenants (–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

#### GET /api/tenants
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

#### GET /api/tenants/:id
–ü–æ–ª—É—á–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø–æ ID

#### POST /api/tenants
–°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

**Body:**
```json
{
  "tenantId": "tnt_myorg",
  "name": "My Organization",
  "domain": "myorg.chat3.com",
  "type": "client",
  "isActive": true
}
```

#### PUT /api/tenants/:id
–û–±–Ω–æ–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

#### DELETE /api/tenants/:id
–£–¥–∞–ª–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

---

### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

#### GET /api/users
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: `(userId,eq,carl)`)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON: `{"createdAt":-1}`

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(userId,eq,carl)` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å userId = carl
- `(type,in,[user,bot])` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–∏–ø–∞ user –∏–ª–∏ bot
- `(name,regex,^John)` - –∏–º—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å John
- `(meta.role,eq,manager)` - —Ñ–∏–ª—å—Ç—Ä –ø–æ meta —Ç–µ–≥—É

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- `dialogCount` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ)
- `unreadDialogsCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ)

#### GET /api/users/:userId
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ userId

#### POST /api/users
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Body:**
```json
{
  "userId": "carl",
  "name": "Carl Johnson",
  "type": "user"
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `userId` –Ω–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ—á–∫—É (`.`)
- `type` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `user`

#### PUT /api/users/:userId
–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Body:**
```json
{
  "name": "New Name",
  "type": "bot"
}
```

#### DELETE /api/users/:userId
–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ (DialogMember)

---

### Dialogs (–î–∏–∞–ª–æ–≥–∏)

#### GET /api/dialogs
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–±–∫–∞–º–∏ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(meta.type,eq,internal)` - –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal
- `(meta.channelType,eq,whatsapp)` - WhatsApp –¥–∏–∞–ª–æ–≥–∏
- `(dialogId,eq,dlg_...)` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥
- `(meta.type,eq,internal)|(meta.type,eq,support)` - –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal –∏–ª–∏ support

#### GET /api/dialogs/:id
–ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ ID

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ (dialogId, tenantId, name, createdAt –∏ —Ç.–¥.)
- `meta` - –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–∏–∞–ª–æ–≥–∞
- `memberCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- `stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞:
  - `topicCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–ø–∏–∫–æ–≤
  - `memberCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  - `messageCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `members` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GET /api/dialogs/:dialogId/members`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ `DialogStats` –∏–ª–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏

#### POST /api/dialogs
–°–æ–∑–¥–∞—Ç—å –¥–∏–∞–ª–æ–≥

**Body:**
```json
{
  "name": "VIP —á–∞—Ç",
  "createdBy": "agent_42",
  "members": [
    {
      "userId": "carl",
      "type": "user",
      "name": "Carl Johnson"
    },
    {
      "userId": "bot_123",
      "type": "bot",
      "name": "Support Bot"
    }
  ],
  "meta": {
    "channel": "whatsapp",
    "greeting": {
      "value": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
      "dataType": "string",
      "scope": "user_alice"
    }
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞ —Å `members`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `User`
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–µ, –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

#### DELETE /api/dialogs/:id
–£–¥–∞–ª–∏—Ç—å –¥–∏–∞–ª–æ–≥

---

### Messages (–°–æ–æ–±—â–µ–Ω–∏—è)

#### GET /api/dialogs/:dialogId/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(type,eq,internal.text)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `(senderId,eq,carl)` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl
- `(meta.channelType,eq,whatsapp)` - WhatsApp —Å–æ–æ–±—â–µ–Ω–∏—è
- `(topicId,eq,topic_abc123...)` - —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞
- `(topicId,eq,null)` - —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Ç–æ–ø–∏–∫–∞
- `(topicId,eq,topic_a)|(topicId,eq,topic_b)` - —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞ topic_a –∏–ª–∏ topic_b
- `(topicId,eq,null)|(topicId,eq,topic_abc)` - —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Ç–æ–ø–∏–∫–∞ –∏–ª–∏ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞

#### POST /api/dialogs/:dialogId/messages
–°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**Body:**
```json
{
  "senderId": "carl",
  "content": "Hello!",
  "type": "internal.text",
  "topicId": "topic_abc123..."  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: ID —Ç–æ–ø–∏–∫–∞, –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ–ø–∏–∫–µ
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `topicId` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ —Ç–æ–ø–∏–∫–∞
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `topicId`, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–æ–ø–∏–∫—É
- –í –æ—Ç–≤–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `topic` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–ø–∏–∫–µ (–µ—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–æ)

#### GET /api/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `(field,direction)`

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(type,eq,internal.text)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `(senderId,eq,carl)` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl
- `(content,regex,–ø—Ä–∏–≤–µ—Ç)` - —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "–ø—Ä–∏–≤–µ—Ç"
- `(type,eq,internal.text)&(senderId,eq,carl)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl
- `(topicId,eq,topic_a)|(topicId,eq,topic_b)` - —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤

#### GET /api/messages/:messageId
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ ID

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ú–∞—Å—Å–∏–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ (statuses) —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Meta —Ç–µ–≥–∏

#### PUT /api/messages/:messageId
–û–±–Ω–æ–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**Body:**
```json
{
  "content": "Updated content"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `content`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `message.update`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è meta —Ç–µ–≥ `updated`

#### PATCH /api/messages/:messageId/topic
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ç–æ–ø–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏—è

**Body:**
```json
{
  "topicId": "topic_abc123..."   // –∏–ª–∏ null –¥–ª—è —Å–±—Ä–æ—Å–∞
}
```

**–ü—Ä–∞–≤–∏–ª–∞ (–≤–∞—Ä–∏–∞–Ω—Ç 1.3):**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ø–∏–∫: —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É —Å–æ–æ–±—â–µ–Ω–∏—è –µ—â—ë –Ω–µ—Ç —Ç–æ–ø–∏–∫–∞ (`topicId = null`). –ü–µ—Ä–µ–¥–∞–π—Ç–µ `topicId` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `topic_` + 20 —Å–∏–º–≤–æ–ª–æ–≤.
- –°–±—Ä–æ—Å–∏—Ç—å —Ç–æ–ø–∏–∫: —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É —Å–æ–æ–±—â–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å —Ç–æ–ø–∏–∫. –ü–µ—Ä–µ–¥–∞–π—Ç–µ `"topicId": null`.
- –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –æ–¥–∏–Ω —Ç–æ–ø–∏–∫ –Ω–∞ –¥—Ä—É–≥–æ–π (A ‚Üí B).
- `topicId` –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–æ–º—É –∂–µ –¥–∏–∞–ª–æ–≥—É, —á—Ç–æ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ `dialogId` —Ç–æ–ø–∏–∫–∞).

**–ö–æ–¥—ã –æ—à–∏–±–æ–∫:**
- `404` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Ç–æ–ø–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–≤ —Ç.—á. —Ç–æ–ø–∏–∫ –Ω–µ –≤ —ç—Ç–æ–º –¥–∏–∞–ª–æ–≥–µ).
- `400` —Å –∫–æ–¥–æ–º `ERROR_TOPIC_CHANGE_NOT_ALLOWED` ‚Äî —É —Å–æ–æ–±—â–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å —Ç–æ–ø–∏–∫, –Ω–µ–ª—å–∑—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–æ–π.
- `400` —Å –∫–æ–¥–æ–º `ERROR_TOPIC_CLEAR_NOT_ALLOWED` ‚Äî —É —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç —Ç–æ–ø–∏–∫–∞, —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–µ—á–µ–≥–æ.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `message.update` —Å `updatedFields: ['message.topicId']`.
- –í –æ—Ç–≤–µ—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è `topic`, `meta`, `statusMessageMatrix`, `reactionSet`).

---

### Message Status (–°—Ç–∞—Ç—É—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π)

#### POST /api/users/:userId/dialogs/:dialogId/messages/:messageId/status/:status
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä status:** –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å. –§–æ—Ä–º–∞—Ç: –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, `_` –∏–ª–∏ `-`, 1‚Äì64 —Å–∏–º–≤–æ–ª–∞ (–≤ –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ). –ü—Ä–∏–º–µ—Ä—ã:
- `unread` ‚Äî –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- `delivered` ‚Äî –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- `read` ‚Äî –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
- `error2`, `failed`, `pending` –∏ —Ç.–ø. ‚Äî –ª—é–±—ã–µ —Å–≤–æ–∏ —Å—Ç–∞—Ç—É—Å—ã –ø–æ —Ñ–æ—Ä–º–∞—Ç—É

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–µ `userType` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—á–µ—Ç—á–∏–∫–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (unreadCount)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId/statuses
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### Message Reactions (–†–µ–∞–∫—Ü–∏–∏)

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId/reactions
–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

#### POST /api/users/:userId/dialogs/:dialogId/messages/:messageId/reactions/:action
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–Ω—è—Ç—å —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action` - –¥–µ–π—Å—Ç–≤–∏–µ: `set` (–¥–æ–±–∞–≤–∏—Ç—å) –∏–ª–∏ `unset` (—É–¥–∞–ª–∏—Ç—å)

**Body:**
```json
{
  "reaction": "üëç"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- `action=set` - –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é (–µ—Å–ª–∏ –µ—ë –µ—â–µ –Ω–µ—Ç)
- `action=unset` - —É–¥–∞–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é (–µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

---

### Topics (–¢–æ–ø–∏–∫–∏)

–¢–æ–ø–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ª–æ–≥–∞ –ø–æ —Ç–µ–º–∞–º. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ç–æ–ø–∏–∫—É —á–µ—Ä–µ–∑ –ø–æ–ª–µ `topicId`. –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ (–ø–æ –¥–∏–∞–ª–æ–≥—É –∏ –ø–æ –¥–∏–∞–ª–æ–≥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –ø–æ–ª—è–º `topicId`, `dialogId` –∏ –ª—é–±—ã–º meta-—Ç–µ–≥–∞–º —Ç–æ–ø–∏–∫–∞ (`meta.*`) –≤ —Ç–æ–º –∂–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ endpoint'—ã (AND/OR, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, –ª–∏–º–∏—Ç—ã).

#### GET /api/dialogs/:dialogId/topics
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª). –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è: `topicId`, `dialogId`, `meta.*` (meta-—Ç–µ–≥–∏ —Ç–æ–ø–∏–∫–∞).
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ —Ç–æ–ø–∏–∫–∞–º:**
- `(topicId,eq,topic_abc123...)` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–ø–∏–∫
- `(meta.name,eq,–í–∞–∂–Ω–∞—è —Ç–µ–º–∞)` - —Ç–æ–ø–∏–∫–∏ —Å –∏–º–µ–Ω–µ–º –ø–æ meta
- `(meta.channelId,eq,whatsapp.chn_6kgxljk)` ‚Äî –ø–æ meta-–∫–ª—é—á—É (–∑–Ω–∞—á–µ–Ω–∏–µ —Å —Ç–æ—á–∫–æ–π –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –±–µ–∑ –∫–∞–≤—ã—á–µ–∫)
- `(meta.priority,in,[support,general])` - —Ç–æ–ø–∏–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º support –∏–ª–∏ general
- `(meta.priority,ne,archived)` - —Ç–æ–ø–∏–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–µ archived
- `(meta.name,regex,^support)` - —Ç–æ–ø–∏–∫–∏, –∏–º—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "support"
- `(meta.name,eq,a)|(meta.name,eq,b)` - —Ç–æ–ø–∏–∫–∏ —Å –∏–º–µ–Ω–µ–º a –∏–ª–∏ b
- `((meta.priority,eq,high)&(meta.category,eq,support))|(meta.name,eq,personal)` - (priority=high –∏ category=support) –∏–ª–∏ name=personal

**–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ meta –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç (–Ω–∏ —Å –∫–∞–≤—ã—á–∫–∞–º–∏, –Ω–∏ –±–µ–∑):**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ meta –≤–æ–æ–±—â–µ –∑–∞–¥–∞–Ω—ã —É —Ç–æ–ø–∏–∫–æ–≤.** –§–∏–ª—å—Ç—Ä –∏—â–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `Meta` (`entityType=topic`, `key`, `value`). –ï—Å–ª–∏ meta –Ω–∏ —Ä–∞–∑—É –Ω–µ –∑–∞–¥–∞–≤–∞–ª–∏ ‚Äî –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π. –ó–∞–¥–∞—Ç—å meta: **PATCH** `/api/dialogs/:dialogId/topics/:topicId` —Å —Ç–µ–ª–æ–º `{ "meta": { "channelId": "whatsapp.chn_6kgxljk" } }` –∏–ª–∏ **PUT** `/api/meta/topic/:topicId/channelId` —Å —Ç–µ–ª–æ–º `{ "value": "whatsapp.chn_6kgxljk" }`.
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ tenant.** –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ tenant –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-TENANT-ID` (–∏–ª–∏ `tnt_default`, –µ—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–µ—Ç). –í –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `Meta` —É –∑–∞–ø–∏—Å–µ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—Ç –∂–µ `tenantId`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –∫ `GET /api/topics` –∏–¥—ë—Ç —Å —Ç–µ–º –∂–µ tenant, —Å –∫–æ—Ç–æ—Ä—ã–º —Å–æ–∑–¥–∞–≤–∞–ª–∏/–æ–±–Ω–æ–≤–ª—è–ª–∏ meta.
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API:** –≤–æ–∑—å–º–∏—Ç–µ –ª—é–±–æ–π `topicId` –∏–∑ `GET /api/topics` (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞) –∏–ª–∏ –∏–∑ `GET /api/dialogs/:dialogId/topics`, –∑–∞—Ç–µ–º –≤—ã–∑–æ–≤–∏—Ç–µ **GET** `/api/meta/topic/:topicId`. –í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `channelId` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `whatsapp.chn_6kgxljk`. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî meta –¥–ª—è —ç—Ç–æ–≥–æ —Ç–æ–ø–∏–∫–∞ –Ω–µ –∑–∞–¥–∞–Ω.
4. –ü—Ä–∏ –ø—É—Å—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ `meta.*` API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª–µ `hint` —Å –∫—Ä–∞—Ç–∫–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–æ–π.

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": [
    {
      "topicId": "topic_abc123...",
      "dialogId": "dlg_...",
      "createdAt": 1234567890,
      "meta": {
        "name": "–í–∞–∂–Ω–∞—è —Ç–µ–º–∞",
        "color": "#FF5733"
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 10
  }
}
```

#### GET /api/users/:userId/dialogs/:dialogId/topics
–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø–∏–∫–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –¥–ª—è GET /api/dialogs/:dialogId/topics (–ø–æ–ª—è: topicId, dialogId, meta.*; AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç `unreadCount` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–ø–∏–∫–∞:**
```json
{
  "data": [
    {
      "topicId": "topic_abc123...",
      "dialogId": "dlg_...",
      "createdAt": 1234567890,
      "meta": {
        "name": "–í–∞–∂–Ω–∞—è —Ç–µ–º–∞"
      },
      "unreadCount": 5
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 10
  }
}
```

#### POST /api/dialogs/:dialogId/topics
–°–æ–∑–¥–∞—Ç—å —Ç–æ–ø–∏–∫ –≤ –¥–∏–∞–ª–æ–≥–µ

**Body:**
```json
{
  "meta": {
    "name": "–ù–æ–≤—ã–π —Ç–æ–ø–∏–∫",
    "color": "#FF5733"
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –¢–æ–ø–∏–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º `topicId`
- –ú–µ—Ç–∞-—Ç–µ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `Meta` (entityType: 'topic')
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `DialogStats.topicCount`

#### GET /api/dialogs/:dialogId/topics/:topicId
–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø–∏–∫ –ø–æ ID

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∞ (topicId, dialogId, tenantId, createdAt)
- `meta` ‚Äî –º–µ—Ç–∞-—Ç–µ–≥–∏ —Ç–æ–ø–∏–∫–∞
- `dialog` ‚Äî –æ–±—ä–µ–∫—Ç –¥–∏–∞–ª–æ–≥–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏: `{ dialogId, tenantId, createdAt?, meta }` (meta –¥–∏–∞–ª–æ–≥–∞; –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

#### PATCH /api/dialogs/:dialogId/topics/:topicId
–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞-—Ç–µ–≥–∏ —Ç–æ–ø–∏–∫–∞

**Body:**
```json
{
  "meta": {
    "name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
    "color": "#00FF00"
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞-—Ç–µ–≥–∏
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö)

---

### Dialog Members (–£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤)

#### GET /api/dialogs/:dialogId/members
–ü–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `filter` - —Ñ–∏–ª—å—Ç—Ä
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

#### POST /api/dialogs/:dialogId/members/add
–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –¥–∏–∞–ª–æ–≥

**Body:**
```json
{
  "userId": "carl",
  "type": "user",
  "name": "Carl Johnson"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `User`
- –ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 200 –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞

#### POST /api/dialogs/:dialogId/members/:userId/remove
–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –¥–∏–∞–ª–æ–≥–∞

#### PATCH /api/dialogs/:dialogId/members/:userId/unread
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**Body:**
```json
{
  "unreadCount": 5,
  "lastSeenAt": 1763551369397.6482,
  "reason": "Manual update"
}
```

---

### User Dialogs (–î–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

#### GET /api/users/:userId/dialogs
–ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `includeLastMessage` - –≤–∫–ª—é—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`true` –∏–ª–∏ `false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`)
- `filter` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: `(field,operator,value)`
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `(field,direction)`
- `unreadCount` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—á–∏—Å–ª–æ –∏–ª–∏ `gte:N`, `gt:N`, `lte:N`, `lt:N`)
- `lastSeenAt` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (`gte:timestamp`, `gt:timestamp`, `lte:timestamp`, `lt:timestamp`)

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(meta.type,eq,internal)` - –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal
- `(meta.channelType,eq,whatsapp)` - WhatsApp –¥–∏–∞–ª–æ–≥–∏
- `(meta.members,in,[john,sara])` - –¥–∏–∞–ª–æ–≥–∏ —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ john –∏–ª–∏ sara
- `(meta.members,$all,[john,sara])` - –¥–∏–∞–ª–æ–≥–∏ –≥–¥–µ –µ—Å—Ç—å –í–°–ï —É–∫–∞–∑–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (john –ò sara)
- `(meta.members,$ne,john)` - –¥–∏–∞–ª–æ–≥–∏ –ë–ï–ó —É—á–∞—Å—Ç–Ω–∏–∫–∞ john
- `(dialogId,eq,dlg_abc123)` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: `(meta.type,eq,internal)&(meta.channelType,ne,telegram)`
- –° –ò–õ–ò: `(meta.type,eq,internal)|(meta.type,eq,support)` ‚Äî –¥–∏–∞–ª–æ–≥–∏ —Ç–∏–ø–∞ internal –∏–ª–∏ support
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: `((topic.meta.category,eq,support)&(topic.meta.priority,eq,high))|(meta.channelType,eq,whatsapp)` ‚Äî (—Ç–æ–ø–∏–∫–∏ support –∏ high) –∏–ª–∏ WhatsApp

**–§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–æ–ø–∏–∫–∞–º:**
- `(topic.topicId,eq,topic_abc123...)` - –¥–∏–∞–ª–æ–≥–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–ø–∏–∫–æ–º
- `(topic.topicId,ne,null)` - –¥–∏–∞–ª–æ–≥–∏ —Å –ª—é–±—ã–º–∏ —Ç–æ–ø–∏–∫–∞–º–∏
- `(topic.topicId,in,[topic1,topic2])` - –¥–∏–∞–ª–æ–≥–∏ —Å –ª—é–±—ã–º –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤
- `(topic.topicId,nin,[topic1,topic2])` - –¥–∏–∞–ª–æ–≥–∏ –±–µ–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤
- `(topic.meta.category,eq,support)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "support"
- `(topic.meta.priority,in,[high,urgent])` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ "high" –∏–ª–∏ "urgent"
- `(topic.meta.status,ne,archived)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏, —Å—Ç–∞—Ç—É—Å –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï "archived"
- `(topic.meta.assignedTo,exists,true)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏, –∏–º–µ—é—â–∏–º–∏ –º–µ—Ç–∞-—Ç–µ–≥ assignedTo
- `(topic.topicCount,gt,0)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º —Ç–æ–ø–∏–∫–æ–º
- `(topic.topicCount,eq,0)` - –¥–∏–∞–ª–æ–≥–∏ –±–µ–∑ —Ç–æ–ø–∏–∫–æ–≤
- `(topic.topicCount,gte,5)` - –¥–∏–∞–ª–æ–≥–∏ —Å 5 –∏ –±–æ–ª–µ–µ —Ç–æ–ø–∏–∫–∞–º–∏
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: `(topic.meta.category,eq,support)&(topic.meta.priority,eq,high)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "support" –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º "high"
- –° –ò–õ–ò –ø–æ —Ç–æ–ø–∏–∫–∞–º: `(topic.meta.category,eq,support)|(topic.meta.category,eq,sales)` - –¥–∏–∞–ª–æ–≥–∏ —Å —Ç–æ–ø–∏–∫–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ support –∏–ª–∏ sales

**–ü—Ä–∏–º–µ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:**
- `(lastInteractionAt,desc)` - –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- `(lastInteractionAt,asc)` - –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é (—Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- `(unreadCount,desc)` - –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (–±–æ–ª—å—à–µ –ø–µ—Ä–≤—ã–º–∏)

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ unreadCount:**
- `unreadCount=5` - —Ç–æ—á–Ω–æ 5 –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `unreadCount=gte:1` - 1 –∏–ª–∏ –±–æ–ª—å—à–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `unreadCount=gt:0` - –±–æ–ª—å—à–µ 0 –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (unreadCount, lastSeenAt, isActive)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `lastInteractionAt` (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ) –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è
- –ï—Å–ª–∏ `includeLastMessage=true`, –≤–∫–ª—é—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º –¥–∏–∞–ª–æ–≥–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `meta.members` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `&` (AND), `|` (OR) –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É —Å–∫–æ–±–∫–∞–º–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª)

#### GET /api/users/:userId/dialogs/:dialogId/messages
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page`, `limit` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `filter` - —Ñ–∏–ª—å—Ç—Ä –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (AND/OR –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è¬ª)
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- `(topicId,eq,topic_abc123...)` - —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞
- `(topicId,eq,null)` - —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Ç–æ–ø–∏–∫–∞
- `(topicId,eq,topic_a)|(topicId,eq,topic_b)` - —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞ topic_a –∏–ª–∏ topic_b
- `(type,eq,internal.text)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `(senderId,eq,carl)` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç carl

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (statusMessageMatrix, reactionSet)
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `topic` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–ø–∏–∫–µ (–µ—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–æ) –∏–ª–∏ `null`

#### GET /api/users/:userId/dialogs/:dialogId/messages/:messageId
–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–æ–±—â–µ–Ω–∏–∏

---

### Packs (–ü–∞–∫–∏)

–ü–∞–∫ ‚Äî —Å—É—â–Ω–æ—Å—Ç—å, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è 0, 1 –∏–ª–∏ –±–æ–ª–µ–µ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –æ–¥–∏–Ω ¬´–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π¬ª –¥–∏–∞–ª–æ–≥. –°–æ—Å—Ç–∞–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PackLink (packId, dialogId, addedAt). –ú–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –ø–∞–∫–æ–≤: `entityType=pack`, `entityId=packId` (—Ñ–æ—Ä–º–∞—Ç `pck_[a-z0-9]{20}`).

#### POST /api/packs
–°–æ–∑–¥–∞—Ç—å –ø–∞–∫

**Body:** –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç `{}` –∏–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å.

**–û—Ç–≤–µ—Ç:** `packId`, `tenantId`, `createdAt`

#### GET /api/packs
–°–ø–∏—Å–æ–∫ –ø–∞–∫–æ–≤ —Ç–µ–Ω–∞–Ω—Ç–∞ (–≤—Å–µ –ø–∞–∫–∏ –ø–æ —Ç–µ–∫—É—â–µ–º—É X-Tenant-ID).

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** `page`, `limit` (–º–∞–∫—Å. 50), `filter` (–ø–æ meta, –Ω–∞–ø—Ä. `(meta.category,eq,support)`), `sort` (–ø–æ–ª–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `createdAt`), `sortDirection` (`asc` / `desc`).

**–û—Ç–≤–µ—Ç:** –º–∞—Å—Å–∏–≤ –ø–∞–∫–æ–≤ —Å –ø–æ–ª—è–º–∏ –ø–∞–∫–∞ –∏ `meta`; `pagination`: page, limit, total, pages.

#### GET /api/packs/:packId
–ü–æ–ª—É—á–∏—Ç—å –ø–∞–∫ –ø–æ ID

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:** –¥–∞–Ω–Ω—ã–µ –ø–∞–∫–∞ (packId, tenantId, createdAt), –æ–±—ä–µ–∫—Ç `meta`, –æ–±—ä–µ–∫—Ç `stats` (dialogCount). –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint GET /api/packs/:packId/dialogs —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

#### DELETE /api/packs/:packId
–£–¥–∞–ª–∏—Ç—å –ø–∞–∫ (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è PackLink)

#### POST /api/packs/:packId/dialogs
–î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–ª–æ–≥ –≤ –ø–∞–∫

**Body:**
```json
{
  "dialogId": "dlg_abcdefghij1234567890"
}
```
- –î–∏–∞–ª–æ–≥ –∏ –ø–∞–∫ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –æ–¥–Ω–æ–º—É tenantId
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ: –µ—Å–ª–∏ –¥–∏–∞–ª–æ–≥ —É–∂–µ –≤ –ø–∞–∫–µ ‚Äî —É—Å–ø–µ—Ö –±–µ–∑ —Å–º–µ–Ω—ã addedAt

#### DELETE /api/packs/:packId/dialogs/:dialogId
–£–±—Ä–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∏–∑ –ø–∞–∫–∞

#### GET /api/packs/:packId/dialogs
–°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ –ø–∞–∫–∞ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** `page`, `limit` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å. 50)

**–û—Ç–≤–µ—Ç:** –º–∞—Å—Å–∏–≤ `{ dialogId, addedAt }`, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ addedAt desc

#### GET /api/packs/:packId/messages
–ï–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–∞–∫–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –≤—Ö–æ–¥—è—â–∏—Ö –≤ –ø–∞–∫, –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è `createdAt`. –ü–∞–≥–∏–Ω–∞—Ü–∏—è ‚Äî –∫—É—Ä—Å–æ—Ä–Ω–∞—è.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (—á–∏—Å–ª–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50, –º–∞–∫—Å–∏–º—É–º 100)
- `cursor` (base64-—Å—Ç—Ä–æ–∫–∞, –ø–æ–ª—É—á–µ–Ω–Ω–∞—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞)
- `filter` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–∞–∫ —É `/api/dialogs/:dialogId/messages`)

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": [
    {
      "messageId": "msg_abcd",
      "dialogId": "dlg_main",
      "sourceDialogId": "dlg_main",
      "content": "–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è",
      "senderId": "user_alpha",
      "senderInfo": {
        "userId": "user_alpha",
        "createdAt": 1720000000.123456,
        "meta": {}
      },
      "createdAt": 1721122334.654321,
      "meta": {},
      "statusMessageMatrix": [],
      "reactionSet": []
    }
  ],
  "cursor": {
    "next": "MTcyMTEyMjMzNC42NTQzMjF8bXNnX2FiY2Q",
    "prev": null
  },
  "hasMore": true
}
```

- `cursor.next` —Å–æ–¥–µ—Ä–∂–∏—Ç base64 –∫—É—Ä—Å–æ—Ä (`createdAt|messageId`), –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- `cursor.prev` –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (—Å–µ–π—á–∞—Å `null` –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã).
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç `sourceDialogId`, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –∏—Å—Ö–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å–æ–æ–±—â–µ–Ω–∏—è.

**–ú–µ—Ç–∞-—Ç–µ–≥–∏ –ø–∞–∫–∞:** `PUT /api/meta/pack/:packId/:key`, `DELETE /api/meta/pack/:packId/:key`, `GET /api/meta/pack/:packId`

#### GET /api/users/:userId/packs
–°–ø–∏—Å–æ–∫ –ø–∞–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–∞–∫–∏, –≤ –¥–∏–∞–ª–æ–≥–∞—Ö –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç)

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** `page`, `limit` (–º–∞–∫—Å. 50), `filter` (–ø–æ meta, –Ω–∞–ø—Ä. `(meta.category,eq,support)`), `sort` (–ø–æ–ª–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `createdAt`), `sortDirection` (`asc` / `desc`)

**–û—Ç–≤–µ—Ç:** –º–∞—Å—Å–∏–≤ –ø–∞–∫–æ–≤ —Å –ø–æ–ª—è–º–∏ –ø–∞–∫–∞ –∏ `meta`; `pagination`: page, limit, total, pages

#### GET /api/users/:userId/dialogs/:dialogId/packs
–°–ø–∏—Å–æ–∫ –ø–∞–∫–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã–µ –≤—Ö–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥

**–î–æ—Å—Ç—É–ø:** —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫ –¥–∏–∞–ª–æ–≥–∞ (–∏–Ω–∞—á–µ 404)

**–û—Ç–≤–µ—Ç:** –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ `{ packId, addedAt, createdAt?, meta }`

---

### Meta Tags (–ú–µ—Ç–∞-—Ç–µ–≥–∏)

#### GET /api/meta/:entityType/:entityId
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ meta —Ç–µ–≥–∏ —Å—É—â–Ω–æ—Å—Ç–∏

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `scope` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π scope –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Entity Types:**
- `dialog` - –¥–∏–∞–ª–æ–≥
- `message` - —Å–æ–æ–±—â–µ–Ω–∏–µ
- `user` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `tenant` - —Ç–µ–Ω–∞–Ω—Ç
- `system` - —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `dialogMember` - —É—á–∞—Å—Ç–Ω–∏–∫ –¥–∏–∞–ª–æ–≥–∞
- `topic` - —Ç–æ–ø–∏–∫
- `pack` - –ø–∞–∫

**–ü—Ä–∏–º–µ—Ä:**
```
GET /api/meta/dialog/dlg_abc123?scope=user_alice
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta —Ç–µ–≥–æ–≤, scoped –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `scope`, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å —ç—Ç–∏–º scope –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ

#### PUT /api/meta/:entityType/:entityId/:key
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å meta —Ç–µ–≥

**Body (–ø—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ):**
```json
{
  "value": "whatsapp"
}
```

**Body (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ):**
```json
{
  "value": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
  "dataType": "string",
  "scope": "user_alice"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `value` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ (string, number, boolean, object, array)
- `dataType` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö: `string`, `number`, `boolean`, `object`, `array` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `string`)
- `scope` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π scope –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `scope` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta —Ç–µ–≥–æ–≤, scoped –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏

#### DELETE /api/meta/:entityType/:entityId/:key
–£–¥–∞–ª–∏—Ç—å meta —Ç–µ–≥

**Path –ø–∞—Ä–∞–º–µ—Ç—Ä `key`:** —Ç–æ—Ç –∂–µ –∞–ª—Ñ–∞–≤–∏—Ç, —á—Ç–æ –∏ –¥–ª—è PUT (–±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ).

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `scope` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ scoped –∑–Ω–∞—á–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ï—Å–ª–∏ `scope` –Ω–µ —É–∫–∞–∑–∞–Ω, —É–¥–∞–ª—è–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ï—Å–ª–∏ `scope` —É–∫–∞–∑–∞–Ω, —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —ç—Ç–∏–º scope

---

### Typing (–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏)

#### POST /api/dialogs/:dialogId/member/:userId/typing
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏

**Body:**
```json
{
  "isTyping": true
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `dialog.typing` –≤ RabbitMQ
- –°–æ–∑–¥–∞–µ—Ç TypingUpdate –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞ (–∫—Ä–æ–º–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞)
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥

---

## –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

- `200` - –£—Å–ø–µ—à–Ω–æ
- `201` - –°–æ–∑–¥–∞–Ω–æ
- `204` - –ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (—É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `409` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## Swagger UI

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:3000/api-docs
```

