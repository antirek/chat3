<template>
  <div class="filter-panel">
    <div class="form-section">
      <label for="messageFilterInput">
        ğŸ” Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ (Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: <code>(Ğ¿Ğ¾Ğ»Ğµ,Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€,Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ)</code>)
      </label>
      <select
        id="messageFilterExample"
        v-model="selectedExample"
        @change="selectExample"
        style="margin-bottom: 8px;"
      >
        <option value="">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°</option>
        <option value="(content,regex,Ğ²ÑÑ‚Ñ€ĞµÑ‚Ğ¸Ğ¼ÑÑ)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ğ²ÑÑ‚Ñ€ĞµÑ‚Ğ¸Ğ¼ÑÑ"</option>
        <option value="(content,regex,ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾"</option>
        <option value="(content,regex,Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚"</option>
        <option value="(content,regex,Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾"</option>
        <option value="(content,regex,Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ğ¾)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ğ¾"</option>
        <option value="(content,regex,Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾)">ğŸ“ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾"</option>
        <option value="(type,eq,internal.text)">ğŸ“ Ğ¢Ğ¸Ğ¿ = internal.text</option>
        <option value="(type,eq,system)">ğŸ“ Ğ¢Ğ¸Ğ¿ = system</option>
        <option value="(type,in,[text,system])">ğŸ“ Ğ¢Ğ¸Ğ¿ Ğ² [text,system]</option>
        <option value="(senderId,eq,carl)">ğŸ‘¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒ = carl</option>
        <option value="(senderId,eq,sara)">ğŸ‘¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒ = sara</option>
        <option value="(senderId,in,[carl,marta])">ğŸ‘¥ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ² [carl,marta]</option>
        <option value="(dialogId,eq,dlg_nfftyjrk53nn5w4bc94n)">ğŸ’¬ Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ = ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚</option>
        <option value="(dialogId,eq,dlg_xndr7w5fhvazpvi8a35p)">ğŸ’¬ Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ = ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ</option>
        <option value="(dialogId,eq,dlg_1qdl3ymr68r2ebve4tqt)">ğŸ’¬ Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ = Ğ¢ĞµÑ…Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°</option>
        <option value="(dialogId,in,[dlg_nfftyjrk53nn5w4bc94n,dlg_xndr7w5fhvazpvi8a35p])">ğŸ’¬ Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ² [ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚,ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ]</option>
        <option value="(meta.channelType,eq,whatsapp)">ğŸ“± WhatsApp ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ</option>
        <option value="(meta.channelType,eq,telegram)">ğŸ“± Telegram ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ</option>
        <option value="(meta.channelId,eq,W0000)">ğŸ“± ĞšĞ°Ğ½Ğ°Ğ» W0000</option>
        <option value="(meta.channelId,eq,TG0000)">ğŸ“± ĞšĞ°Ğ½Ğ°Ğ» TG0000</option>
        <option value="(meta.channelType,in,[whatsapp,telegram])">ğŸ“± WhatsApp Ğ¸Ğ»Ğ¸ Telegram</option>
        <option value="(createdAt,gte,2025-10-24)">ğŸ“… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ â‰¥ 24.10.2025</option>
        <option value="(createdAt,gte,2025-10-22)">ğŸ“… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ â‰¥ 22.10.2025</option>
        <option value="(createdAt,lt,2025-10-21)">ğŸ“… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ < 21.10.2025</option>
        <option value="(content,regex,Ğ²ÑÑ‚Ñ€ĞµÑ‚Ğ¸Ğ¼ÑÑ)&(type,eq,system)">ğŸ“ "Ğ²ÑÑ‚Ñ€ĞµÑ‚Ğ¸Ğ¼ÑÑ" + system</option>
        <option value="(senderId,eq,carl)&(type,eq,system)">ğŸ‘¤ Carl + system</option>
        <option value="(content,regex,ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾)&(createdAt,gte,2025-10-24)">ğŸ“ "ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾" + â‰¥24.10</option>
        <option value="(senderId,in,[carl,sara])&(type,eq,internal.text)&(content,regex,Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚)">ğŸ‘¥ Carl/Sara + internal.text + "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚"</option>
        <option value="(dialogId,eq,dlg_nfftyjrk53nn5w4bc94n)&(senderId,eq,carl)">ğŸ’¬ ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ + Carl</option>
        <option value="(dialogId,eq,dlg_xndr7w5fhvazpvi8a35p)&(type,eq,internal.text)">ğŸ’¬ ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ + internal.text</option>
        <option value="(dialogId,in,[dlg_nfftyjrk53nn5w4bc94n,dlg_xndr7w5fhvazpvi8a35p])&(senderId,eq,marta)">ğŸ’¬ ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚/ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ½Ñ‹Ğµ + Marta</option>
        <option value="(meta.channelType,eq,whatsapp)&(senderId,eq,carl)">ğŸ“± WhatsApp + Carl</option>
        <option value="(meta.channelType,eq,telegram)&(type,eq,internal.text)">ğŸ“± Telegram + internal.text</option>
        <option value="(meta.channelId,eq,W0000)&(content,regex,Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚)">ğŸ“± W0000 + "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚"</option>
        <option value="(meta.channelType,in,[whatsapp,telegram])&(senderId,in,[carl,sara])">ğŸ“± WhatsApp/Telegram + Carl/Sara</option>
        <option value="(dialogId,eq,dlg_nfftyjrk53nn5w4bc94n)&(meta.channelType,eq,telegram)">ğŸ’¬ ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ + Telegram</option>
        <option value="(meta.channelId,eq,TG0000)&(type,eq,system)">ğŸ“± TG0000 + system</option>
        <option value="(dialogId,in,[dlg_nfftyjrk53nn5w4bc94n,dlg_xndr7w5fhvazpvi8a35p])&(senderId,in,[carl,marta])&(meta.channelType,eq,telegram)">ğŸ’¬ 2 Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° + 2 Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»Ñ + Telegram</option>
        <option value="custom">âœï¸ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€</option>
      </select>
      <div class="input-with-clear" style="margin-bottom: 8px;">
        <input
          type="text"
          id="messageFilterInput"
          v-model="filterInput"
          placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹"
          @keydown.enter="apply"
        />
        <button
          class="clear-field"
          type="button"
          @click="clear"
          title="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ"
        >
          âœ•
        </button>
      </div>
      <small style="display: block; color: #6c757d;">
        ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾Ğ»Ñ `content`, `type`, `senderId`, `dialogId`, `meta.*`, `createdAt`. ĞĞ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹: eq, ne, in, nin, regex, gt, lt, gte, lte.
      </small>
    </div>
    <div class="form-actions">
      <button class="btn-primary" type="button" @click="apply">ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue';

interface Props {
  filterInput: string;
  selectedFilterExample: string;
}

interface Emits {
  (e: 'update:filterInput', value: string): void;
  (e: 'update:selectedFilterExample', value: string): void;
  (e: 'select-example'): void;
  (e: 'clear'): void;
  (e: 'apply'): void;
}

const props = defineProps<Props>();
const emit = defineEmits<Emits>();

const filterInput = ref(props.filterInput);
const selectedExample = ref(props.selectedFilterExample);

watch(() => props.filterInput, (val) => {
  filterInput.value = val;
});

watch(() => props.selectedFilterExample, (val) => {
  selectedExample.value = val;
});

watch(filterInput, (val) => {
  emit('update:filterInput', val);
});

watch(selectedExample, (val) => {
  emit('update:selectedFilterExample', val);
});

function selectExample() {
  emit('select-example');
}

function clear() {
  emit('clear');
}

function apply() {
  emit('apply');
}
</script>

<style scoped>
.filter-panel {
  padding: 15px 20px;
  border-bottom: 1px solid #e9ecef;
  background: #ffffff;
}

.filter-panel .form-section {
  margin-bottom: 12px;
}

.filter-panel label {
  display: block;
  margin-bottom: 6px;
  font-size: 12px;
  font-weight: 500;
  color: #495057;
}

.filter-panel select,
.filter-panel input {
  width: 100%;
  padding: 6px 10px;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 12px;
  background: white;
}

.filter-panel .input-with-clear {
  position: relative;
  display: flex;
  align-items: center;
}

.filter-panel .input-with-clear input {
  padding-right: 30px;
}

.filter-panel .clear-field {
  position: absolute;
  right: 5px;
  background: none;
  border: none;
  color: #6c757d;
  cursor: pointer;
  font-size: 16px;
  padding: 2px 6px;
  border-radius: 3px;
}

.filter-panel .clear-field:hover {
  background: #e9ecef;
  color: #333;
}

.filter-panel .form-actions {
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
}

button {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: #667eea;
  color: white;
  border: none;
}

.btn-primary:hover:not(:disabled) {
  background: #5a6fd8;
}
</style>
